# Configuration for model evaluation with spatial analysis

# Data configuration
data:
  # Data path will be specified via command line
  target_column: "vhm0_y" # Target column name (currently hardcoded in code)
  # model_path: "/Users/deeplab/Documents/projects/hcmr/data/experiments/20250922_2148_xgb_500K_samples_robust_stratified"
  model_path: "/Users/deeplab/Documents/projects/hcmr/data/experiments/20250921_2203_xgb_500K_samples_basin/"
  data_path: "/Users/deeplab/Documents/projects/hcmr/data/hourly"
  file_pattern: "*.parquet"

# Feature configuration (synchronized with training pipeline)
feature_block:
  # Features to exclude from the feature set
  features_to_exclude:
    - "corrected_VTM02"
    - "time"
    - "lat"
    - "lon"
    - "latitude"
    - "longitude"

  # Geographic context features
  use_geo_context:
    enabled: false # Set to true to enable geographic context features
    include_basin: true # Include basin categorical feature (0=Atlantic, 1=Mediterranean, 2=Eastern Med)

  # Lag features for temporal patterns
  lag_features:
    enabled: false # Set to true to enable lag features
    lags:
      vhm0_x: [1, 3, 6] # Lag hours for significant wave height
      wspd: [1, 3, 6] # Lag hours for wind speed
      vtm02: [1, 3, 6] # Lag hours for wave period
      wdir: [1, 3, 6] # Lag hours for wind direction
      vmdr: [1, 3, 6] # Lag hours for wave direction

  # Regional training (filter to specific regions)
  regional_training:
    enabled: false # Set to true to enable regional training
    training_regions: [0] # Regions to include in training: [0] (atlantic), [1] (mediterranean), [2] (eastern_med)

  # Sea-bin metrics for performance analysis across wave height ranges
  sea_bin_metrics:
    enabled: true # Set to true to enable sea-bin metrics
    bins:
      - name: "calm"
        min: 0.0
        max: 1.0
        description: "Calm conditions"
      - name: "light"
        min: 1.0
        max: 2.0
        description: "Light seas"
      - name: "moderate"
        min: 2.0
        max: 3.0
        description: "Moderate seas"
      - name: "rough"
        min: 3.0
        max: 4.0
        description: "Rough seas"
      - name: "very_rough"
        min: 4.0
        max: 6.0
        description: "Very rough seas"
      - name: "high"
        min: 6.0
        max: 10.0
        description: "High seas"
      - name: "very_high"
        min: 10.0
        max: 12.0
        description: "Very high seas"
      - name: "phenomenal"
        min: 12.0
        max: 999.0
        description: "Phenomenal seas"

# Preprocessing configuration (synchronized with training pipeline)
# preprocessing:
#   scaler: "standard" # Options: "standard", "robust", "minmax", "null"

#   # Regional scaling (applies different scalers to different regions)
#   regional_scaling:
#     enabled: false # Set to true to enable regional scaling
#     # NOTE: Cannot be used with scaler: "null"

# Evaluation configuration
evaluation:
  year: "2023"
  max_files: null # Process all December 2023 files (31 days) for faster evaluation
  # Spatial metrics to compute and plot
  spatial_metrics:
    - "bias"
    - "mae"
    - "rmse"
    - "pearson"
    - "diff"
    - "var_true"
    - "var_pred"
    - "snr"
    - "snr_db"

  # Temporal analysis
  temporal_analysis:
    enabled: true # Let users skip temporal analysis
    daily_metrics: true
    monthly_metrics: true
    seasonal_metrics: true
    create_plots: true

  # Plot settings (currently hardcoded in code)
  plots:
    marker_size: 8
    alpha: 0.85
    colormap: "RdYlBu_r"
    metrics_to_plot: ["bias", "mae", "rmse", "diff"]

# S3 configuration for model loading and results saving
s3:
  enabled: false # Enable S3 model loading
  bucket: "medwav-dev-data" # S3 bucket name
  region: "eu-central-1" # AWS region
  aws_profile: null # AWS profile name (optional, uses default if null)

# Output configuration
output:
  output_dir: "evaluation_results_refactored"
  save_plots: true # Let users skip plot generation

  # S3 configuration for saving results
  s3:
    enabled: false # Set to true to enable S3 saving
    bucket: "medwav-dev-data" # Replace with your S3 bucket
    prefix: "experiments/full_dataset_experiment/xgb_500k_samples_20250917/evaluation_results" # S3 prefix for organizing results
    region: "eu-central-1" # AWS region
    aws_profile: null # AWS profile name (optional, uses default if null)

# Parallel processing configuration
parallel_processing:
  enabled: false # Re-enable parallel processing for speed
  n_workers: 4 # Use 4 workers for processing all 365 files
  batch_size: 8 # Process 10 files per batch for efficiency
  use_multiprocessing: false # Use ProcessPoolExecutor for true parallelism
  max_workers: 6 # Maximum number of workers

# Training diagnostics
diagnostics:
  enabled: true
  plots_save_path: "evaluation_results_refactored/diagnostic_plots"
  save_training_history: false
  create_learning_curves: false
  create_residual_plots: false
  create_prediction_plots: false
  create_regional_analysis: true # Enable regional performance analysis plots
  create_sea_bin_analysis: true # Enable sea-bin performance analysis plots
  create_spatial_maps: false
  create_regional_error_box_plots: true
  create_wave_height_performance_plots: true
  create_snr_comparison_plot: false
